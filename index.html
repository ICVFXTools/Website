<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ICVFXTools.com - 3D Showcase</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Orbitron:wght@700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet"/>

  <!-- three.js Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <style>
    /* ========================================
       CSS STYLES & LAYOUT
       ======================================== */

    :root {
      --color-bg: #000000;
      --color-primary: #ff1d53;
      --color-glow: rgba(255, 29, 83, 0.7);
      --color-text: #ffffff;
      --color-text-muted: #e4e4e4;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden; /* This will be changed for mobile */
      font-family: "Roboto Mono", monospace;
      background-color: var(--color-bg);
      color: var(--color-text);
    }

    /* Scanlines Overlay */
    body::after {
      content: '';
      position: absolute;
      inset: 0;
      background: repeating-linear-gradient(
        0deg,
        rgba(0,0,0,0.3) 0px,
        rgba(0,0,0,0.3) 1px,
        transparent 1px,
        transparent 3px
      );
      pointer-events: none;
      z-index: 100;
      opacity: 0.5;
    }

    /* Background 3D canvas */
    #bg-canvas {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    /* Main layout */
    main {
      position: relative;
      z-index: 2;
      width: 100vw;
      height: 100vh;
      display: grid;
      grid-template-columns: 1fr auto;
      grid-template-rows: auto minmax(0, 1fr) auto;
      padding: 2rem;
      mix-blend-mode: difference; 
    }

    main > * { min-height: 0; }

    /* Header */
    #header {
      grid-column: 1 / -1;
      font-family: 'Orbitron', sans-serif;
      font-size: 1.5rem;
      color: var(--color-primary);
      text-shadow: 0 0 10px var(--color-glow);
      padding-bottom: 1rem;
    }

    /* Footer */
    footer {
      grid-column: 1 / -1;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      color: var(--color-text-muted);
      padding-top: 1rem;
    }

    .social-links a {
      color: var(--color-text-muted);
      text-decoration: none;
      margin-left: 1.5rem;
      transition: color 0.2s ease;
    }
    .social-links a:hover { color: var(--color-primary); }

    /* Left content */
    .plugin-display {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: flex-start;
      padding-left: 5vw;
      grid-column: 1 / 2;
      grid-row: 2 / 3;
      min-height: 0;
    }

    .plugin-display h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 3.5rem;
      font-weight: 700;
      line-height: 1.1;
      margin-bottom: 1.5rem;
      letter-spacing: 1px;
      color: var(--color-primary);
      text-shadow: 0 0 15px var(--color-glow);
      animation: fadeIn 0.5s ease-out 0.1s forwards;
      -webkit-text-stroke: 5px #000;
      paint-order: stroke fill;
    }

    .plugin-display p {
      font-size: 1.1rem;
      line-height: 1.7;
      color: var(--color-text-muted);
      max-width: 400px;
      margin-bottom: 2.5rem;
      text-shadow: 0 0 5px rgba(0,0,0,0.5);
      animation: fadeIn 0.5s ease-out 0.2s forwards;
    }

    .button-group {
      display: flex;
      align-items: center;
      gap: 1rem;
      animation: fadeIn 0.5s ease-out 0.3s forwards;
      flex-wrap: wrap; /* Allow buttons to wrap */
      width: 400px;
    }

    .action-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.8rem 1.8rem;
      background: transparent;
      color: var(--color-primary);
      text-decoration: none;
      border-radius: 4px;
      font-weight: 600;
      border: 2px solid var(--color-primary);
      transition: background-color 0.2s ease, text-shadow 0.2s ease;
      font-size: 0.9rem;
      line-height: 1;
    }

    .action-btn svg {
      width: 1.15em;
      height: 1.15em;
      flex: none;
      display: inline-block;
    }

    .action-btn span {
      display: inline-block;
      line-height: 1;
    }
    .action-btn:hover {
      background-color: var(--color-primary);
      color: var(--color-bg);
      text-shadow: 0 0 10px var(--color-glow);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* Sidebar list */
    .plugin-list {
      grid-column: 2 / 3;
      grid-row: 2 / 3;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 1rem;
      padding: 1rem;
      width: 300px;
      overflow-y: auto;
      padding-right: 0.5rem;
      min-height: 0;
      max-height: 100%;
    }

    /* Scrollbar */
    .plugin-list::-webkit-scrollbar { width: 6px; }
    .plugin-list::-webkit-scrollbar-track { background: transparent; }
    .plugin-list::-webkit-scrollbar-thumb {
      background-color: var(--color-text-muted);
      border-radius: 3px;
    }
    .plugin-list::-webkit-scrollbar-thumb:hover {
      background-color: var(--color-primary);
    }

    /* List items */
    .plugin-item {
      cursor: pointer;
      padding: 0.75rem 1rem;
      border-left: 2px solid transparent;
      transition: color 0.2s ease, border-color 0.2s ease, background-color 0.2s ease;
      position: relative;
      overflow: hidden;
      z-index: 1;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .plugin-item-thumb {
      width: 40px;
      height: 40px;
      border-radius: 4px;
      background-color: #333;
      flex-shrink: 0;
      border: 1px solid rgba(255,255,255,0.1);
      object-fit: cover;
    }

    .plugin-item-text { flex-grow: 1; }

    .plugin-item::before {
      content: '';
      position: absolute;
      bottom: 0; left: 0;
      width: 100%;
      height: 0;
      background-color: var(--color-glow);
      opacity: 0.5;
      z-index: -1;
      transition: height 0s;
    }
    .plugin-item.loading::before {
      height: 100%;
      transition: height 5s linear;
    }

    .plugin-item:hover { background-color: rgba(255, 29, 83, 0.05); }

    .plugin-item h3 {
      font-family: 'Orbitron', sans-serif;
      font-size: 0.9rem;
      color: var(--color-text-muted);
      margin-bottom: 0.25rem;
      transition: color 0.2s ease;
    }
    .plugin-item p {
      font-family: "Roboto Mono", monospace;
      font-size: 0.8rem;
      color: #666;
      transition: color 0.2s ease;
    }

    .plugin-item:hover h3, .plugin-item.active h3 {
      color: var(--color-primary);
      text-shadow: 0 0 10px var(--color-glow);
    }
    .plugin-item:hover p, .plugin-item.active p { color: var(--color-text-muted); }
    .plugin-item.active { border-color: var(--color-primary); }

    /* ========================================
       MOBILE RESPONSIVE STYLES
       ======================================== */
    @media (max-width: 800px) {
      /* Hide 3D canvas on mobile */
      #bg-canvas {
        display: none;
      }
      
      /* Allow scrolling on mobile */
      html, body { overflow: auto; }
      
      /* Change main layout to vertical stack */
      main {
        display: flex;
        flex-direction: column;
        padding: 1.5rem;
        height: auto;
      }
      #header { 
        position: static; 
        order: 0; /* Added for clarity */
      }
      footer { 
        position: static; 
        margin-top: 2rem; 
        flex-direction: column; 
        gap: 1rem; 
        order: 3; /* This fixes the footer position */
      }

      /* Center main content */
      .plugin-display {
        padding: 0;
        min-height: 70vh;
        align-items: center;
        text-align: center;
        order: 1;
      }
      .plugin-display h1 { font-size: 2.5rem; }
      .plugin-display p { font-size: 1rem; }
      
      /* Center button group on mobile */
      .button-group {
        justify-content: center;
        
      }

      /* Convert sidebar to horizontal-wrapping list */
      .plugin-list {
        order: 2;
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
        gap: 1rem;
        padding-bottom: 2rem;
        overflow-y: hidden;
        padding-right: 1rem;
        min-height: auto;
        max-height: none; /* remove desktop height constraints */
      }

      /* Make list items full-width */
      .plugin-item {
        border-left: none;
        border-bottom: 2px solid transparent;
        text-align: left;
        flex-basis: 100%;
      }
      .plugin-item.active { border-color: var(--color-primary); }
    }
  </style>
</head>
<body>

  <!-- 3D Background Canvas -->
  <canvas id="bg-canvas"></canvas>

  <!-- Main Content Wrapper -->
  <main>
    <header id="header">ICVFXTOOLS</header>

     <!-- Left Content: Plugin Details -->
     <div class="plugin-display">
        <h1 id="pluginTitle"></h1>
        <p id="pluginDescription"></p>
        <div class="button-group">
            <a href="#" id="marketplaceLink" class="action-btn" target="_blank">
                <!-- Marketplace Icon -->
                <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M19 4h-3.5a2.5 2.5 0 0 0-5 0H7c-1.1 0-2 .9-2 2v13c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5-1.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5-1.5-.67-1.5-1.5.67-1.5 1.5 1.5zm3.5 17H7V6h1.5v3h7V6H17v13z"></path></svg>
                Marketplace
            </a>
            <a href="#" id="youtubeLink" class="action-btn" target="_blank">
                <!-- YouTube Icon -->
                <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M21.58 7.19c-.23-.86-.9-1.52-1.76-1.74C18.25 5 12 5 12 5s-6.25 0-7.82.45c-.86.22-1.53.88-1.76 1.74C2 8.75 2 12 2 12s0 3.25.42 4.81c.23.86.9 1.52 1.76 1.74C5.75 19 12 19 12 19s6.25 0 7.82-.45c.86-.22 1.53.88 1.76-1.74C22 15.25 22 12 22 12s0-3.25-.42-4.81zM10 15.46V8.54l5.22 3.46L10 15.46z"></path></svg>
                YouTube
            </a>
            <a href="#" id="documentationLink" class="action-btn" target="_blank">
                <!-- Documentation Icon (Book) -->
                <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"></path></svg>
                Documentation
            </a>
            <a href="#" id="forumLink" class="action-btn" target="_blank">
                <!-- Forum Icon (People) -->
                <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"></path></svg>
                Forum
            </a>
        </div>
    </div>

    <!-- Right Content: Plugin List (Sidebar) -->
    <div class="plugin-list" id="pluginListContainer"></div>

    <!-- Footer -->
    <footer>
      <span>© 2025 ICVFXTools. All Rights Reserved.</span>
      <div class="social-links">
        <a href="#">X</a>
        <a href="#">INSTAGRAM</a>
        <a href="https://www.youtube.com/@ICVFXTools">YOUTUBE</a>
      </div>
    </footer>
  </main>

   <script>
        document.addEventListener('DOMContentLoaded', () => {

            /* ========================================
               CONTENT
               ======================================== */
            const plugins = [
                {
                    title: "Cube LUT Importer",
                    subtext: "Advanced Color Grading",
                    description: "Instantly import and manage high-fidelity Cube LUTs for professional, cinematic color grading directly in Unreal Engine.",
                    subtitle: [ "High-fidelity color grading for Unreal Engine.", "Import and apply .cube files instantly." ],
                    showcaseImageUrl: "img/cubelut.png",
                    thumbnailUrl: "img/cubelutico.png",
                    marketplaceUrl: "https://www.fab.com/listings/4a58faa9-921a-4052-9e14-95fb3c77e760", // Example Link
                    youtubeUrl: "https://youtu.be/hNIfqfWbxE8", // Example Link
                    documentationUrl: "https://docs.google.com/document/d/1aCAy9EsEifOF1CwOK79NE254KMvGznStnclZGpRzUjk/edit?usp=sharing", // Placeholder
                    forumUrl: "https://forums.unrealengine.com/t/icvfx-tools-cubelut-importer/2662480" // Placeholder
                },
                {
                    title: "Network Timecode Sync",
                    subtext: "Multi-Machine Timecoded Sync",
                    description: "Keep all your production machines in perfect harmony. This tool provides robust, low-latency timecode synchronization across multiple Unreal Engine instances over a local network.",
                    subtitle: [ "Synchronize timecode across multiple machines.", "Robust, low-latency sync over LAN." ],
                    showcaseImageUrl: "img/nts.png",
                    thumbnailUrl: "img/ntsico.png",
                    marketplaceUrl: "https://www.fab.com/listings/601e3297-c485-45e6-a030-f188e5dec520", // Example Link
                    youtubeUrl: "https://youtu.be/fM5553H3_kM", // Example Link
                    documentationUrl: "https://docs.google.com/document/d/19wAUWFfvg5pVAg3ZyTPnWvBg-dMZpA0XVExhM8v0wT0/edit?usp=sharing", // Placeholder
                    forumUrl: "https://forums.unrealengine.com/t/icvfx-tools-network-timecode-sync-plugin/2650273" // Placeholder
                },
                {
                    title: "HYPRDeck Control",
                    subtext: "Control BMD Hyperdeck Recorder",
                    description: "A comprehensive and robust solution for controlling and monitoring Blackmagic Design HyperDeck disk recorders directly from Unreal Engine.",
                    subtitle: [ "Control and monitor Blackmagic HyperDeck recorders.", "A comprehensive, robust, and integrated solution." ],
                    showcaseImageUrl: "img/hypr.png",
                    thumbnailUrl: "img/hyprico.png",
                    marketplaceUrl: "https://www.fab.com/listings/e4348a47-dea6-479b-a67f-8819a5ff0d8c", // Example Link
                    youtubeUrl: "https://youtu.be/K-8tL2G8f-c", // Example Link
                    documentationUrl: "https://docs.google.com/document/d/17wdb4LNC3RfWrqjt-dOydf519Xk3bemsP4x9K63dkNU/edit?usp=sharing", // Placeholder
                    forumUrl: "https://forums.unrealengine.com/t/icvfx-tools-hyprdeck-control-plugin/2662337" // Placeholder
                }
            ];
            // Restored original image paths and links as requested.

            /* ========================================
               DYNAMIC COLOR GENERATION (ADAPTIVE)
               ======================================== */
            (function assignAdaptiveColors(arr) {
                const total = arr.length;
                const sat = 0.9;
                const light = 0.55;
                const hueStart = 0; // 0 degrees (red)
                const hueSpan  = 240; // 240 degrees (blue)

                arr.forEach((plugin, i) => {
                  const fraction = total > 1 ? (i / (total - 1)) : 0;
                  const hueDeg = hueStart + fraction * hueSpan;
                  const color = new THREE.Color();
                  color.setHSL(hueDeg / 360, sat, light);
                  plugin.color = color.getHex();
                });
            })(plugins);

            // DOM references
            const listContainer   = document.getElementById('pluginListContainer');
            const titleEl         = document.getElementById('pluginTitle');
            const descEl          = document.getElementById('pluginDescription');
            const marketplaceLinkEl = document.getElementById('marketplaceLink');
            const youtubeLinkEl   = document.getElementById('youtubeLink');
            const documentationLinkEl = document.getElementById('documentationLink'); // Added
            const forumLinkEl = document.getElementById('forumLink'); // Added
            const canvasEl        = document.getElementById('bg-canvas');

            // 3D globals
            let scene, camera, renderer, particleSystem, imagePlane, subtitlePlane, textureLoader;
            let subtitleContext, subtitleCanvas, subtitleTexture, typewriterInterval;
            let currentIndex = 0;
            let autoSwitchTimeout, idleTimeout;
            let backgroundPlane;
            
            // Check for mobile view on load
            const isMobileView = window.innerWidth <= 800;

            // Typewriter variables
            let currentLineIndex = 0;
            let currentCharIndex = 0;
            let typewriterLines = [];
            let typeWriterLineHeight = 36;
            let typeWriterStartY = 30;

            /**
             * Updates all content on the page based on the selected plugin index.
             */
            function updateDisplay(index) {
                currentIndex = index;
                const plugin = plugins[index];

                // --- Update Text Content & Links ---
                const elementsToAnimate = [titleEl, descEl, marketplaceLinkEl.parentElement];
                elementsToAnimate.forEach(el => { el.style.animation = 'none'; void el.offsetWidth; });

                titleEl.textContent = plugin.title;
                descEl.textContent = plugin.description;
                marketplaceLinkEl.href = plugin.marketplaceUrl;
                youtubeLinkEl.href = plugin.youtubeUrl;
                documentationLinkEl.href = plugin.documentationUrl; // Added
                forumLinkEl.href = plugin.forumUrl; // Added

                elementsToAnimate.forEach(el => { el.style.animation = ''; });

                // --- 3D Updates (Desktop Only) ---
                if (!isMobileView) {
                    // --- Update 3D Image ---
                    textureLoader.load(plugin.showcaseImageUrl, (texture) => {
                        imagePlane.material.map = texture;
                        imagePlane.material.needsUpdate = true;
                    },
                    undefined, // onProgress callback (not needed)
                    (err) => { // onError callback
                        console.error('Error loading texture:', plugin.showcaseImageUrl, err);
                        // Optional: Load a fallback placeholder if local image fails
                        textureLoader.load('https://placehold.co/1600x900/111/fff?text=Image+Error', (fallbackTexture) => {
                            imagePlane.material.map = fallbackTexture;
                            imagePlane.material.needsUpdate = true;
                        });
                    });

                    // --- Update 3D Subtitle ---
                    startTypewriter(plugin.subtitle);

                    // --- Update 3D Particle & Background Color ---
                    if (particleSystem) { particleSystem.material.color.set(plugins[index].color); }
                    if (backgroundPlane) { backgroundPlane.material.color.set(plugins[index].color); }
                }

                // --- Update Sidebar Active State ---
                document.querySelectorAll('.plugin-item').forEach((item, i) => {
                    item.classList.toggle('active', i === index);
                });

                // --- Update Primary Theme Color ---
                const newColor = `#${plugins[index].color.toString(16).padStart(6, '0')}`;
                document.documentElement.style.setProperty('--color-primary', newColor);
                document.documentElement.style.setProperty('--color-glow', `${newColor}b3`); // b3 = ~70% opacity
            }

            /**
             * Builds the sidebar list on page load.
             */
            plugins.forEach((plugin, index) => {
                const item = document.createElement('div');
                item.className = 'plugin-item';
                item.dataset.index = index;
                item.innerHTML = `
                    <img src="${plugin.thumbnailUrl}" alt="${plugin.title} thumbnail" class="plugin-item-thumb" onerror="this.src='https://placehold.co/100x100/333/eee?text=Error'">
                    <div class="plugin-item-text">
                        <h3>${plugin.title}</h3>
                        <p>${plugin.subtext}</p>
                    </div>
                `;
                listContainer.appendChild(item);
            });

            /**
             * Starts the automatic cycling through plugins.
             */
            function startAutoSwitchCycle() {
                const cycle = () => {
                    const nextIndex = (currentIndex + 1) % plugins.length;
                    const nextItem = document.querySelector(`.plugin-item[data-index='${nextIndex}']`);
                    if (nextItem) nextItem.classList.add('loading');

                    autoSwitchTimeout = setTimeout(() => {
                        if (nextItem) nextItem.classList.remove('loading');
                        updateDisplay(nextIndex);
                        cycle();
                    }, 5000); // Auto-switch speed (ms)
                };
                cycle();
            }

            /**
             * Resets the idle timer when user interacts.
             */
            function resetIdleTimer() {
                clearTimeout(autoSwitchTimeout);
                clearTimeout(idleTimeout);
                const loadingItem = document.querySelector('.plugin-item.loading');
                if (loadingItem) loadingItem.classList.remove('loading');
                idleTimeout = setTimeout(startAutoSwitchCycle, 10000); // Idle time (ms)
            }

            // --- Event Listeners ---
            listContainer.addEventListener('click', (e) => {
                const item = e.target.closest('.plugin-item');
                if (item) {
                    updateDisplay(parseInt(item.dataset.index, 10));
                    resetIdleTimer();
                }
            });

            /**
             * Animates the multi-line typewriter effect.
             */
            function animateTypewriter() {
                if (currentLineIndex >= typewriterLines.length) {
                    clearInterval(typewriterInterval); return;
                }
                subtitleContext.clearRect(0, 0, subtitleCanvas.width, subtitleCanvas.height);
                for (let i = 0; i < currentLineIndex; i++) {
                    subtitleContext.fillText(typewriterLines[i], subtitleCanvas.width / 2, typeWriterStartY + (i * typeWriterLineHeight));
                }
                const currentLine = typewriterLines[currentLineIndex];
                const currentText = currentLine.substring(0, currentCharIndex);
                subtitleContext.fillText(currentText, subtitleCanvas.width / 2, typeWriterStartY + (currentLineIndex * typeWriterLineHeight));
                subtitleTexture.needsUpdate = true;
                currentCharIndex++;
                if (currentCharIndex > currentLine.length) {
                    currentLineIndex++; currentCharIndex = 0;
                }
            }
            /**
             * Starts the typewriter effect for the given lines of text.
             */
            function startTypewriter(lines) {
                clearInterval(typewriterInterval);
                typewriterLines = lines || [];
                currentLineIndex = 0;
                currentCharIndex = 0;
                if (subtitleContext) {
                    subtitleContext.clearRect(0, 0, subtitleCanvas.width, subtitleCanvas.height);
                    subtitleTexture.needsUpdate = true;
                }
                typewriterInterval = setInterval(animateTypewriter, 50); // Typewriter speed (ms)
            }

            /**
             * Initializes the three.js 3D scene.
             */
            function init3D() {
                scene = new THREE.Scene();
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                renderer = new THREE.WebGLRenderer({ canvas: canvasEl, antialias: true, alpha: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

                textureLoader = new THREE.TextureLoader();

                // Main image plane
                const planeGeometry = new THREE.PlaneGeometry(6.5, 6.5 * (9/16));
                const planeMaterial = new THREE.MeshBasicMaterial({ transparent: true });
                imagePlane = new THREE.Mesh(planeGeometry, planeMaterial);
                scene.add(imagePlane);

                // Background color plane
                const backgroundPlaneGeometry = new THREE.PlaneGeometry(6.6, 6.6 * (9/16));
                const backgroundPlaneMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff });
                backgroundPlane = new THREE.Mesh(backgroundPlaneGeometry, backgroundPlaneMaterial);
                imagePlane.add(backgroundPlane);
                backgroundPlane.position.z = -0.01;

                // Subtitle plane
                subtitleCanvas = document.createElement('canvas');
                subtitleCanvas.width = 1024;
                subtitleCanvas.height = 128;
                subtitleContext = subtitleCanvas.getContext('2d');
                subtitleContext.font = "28px 'Roboto Mono', monospace";
                subtitleContext.fillStyle = 'rgba(255, 255, 255, 0.8)';
                subtitleContext.textAlign = 'center';

                subtitleTexture = new THREE.CanvasTexture(subtitleCanvas);
                const subtitleGeometry = new THREE.PlaneGeometry(6.1, 6.1 * (subtitleCanvas.height/subtitleCanvas.width));
                const subtitleMaterial = new THREE.MeshBasicMaterial({ map: subtitleTexture, transparent: true });
                subtitlePlane = new THREE.Mesh(subtitleGeometry, subtitleMaterial);
                subtitlePlane.position.y = -2.4;
                scene.add(subtitlePlane);

                // Background particles
                const particleCount = 5000;
                const positions = new Float32Array(particleCount * 3);
                for (let i = 0; i < particleCount * 3; i++) {
                    positions[i] = (Math.random() - 0.5) * 15;
                }
                const particlesGeometry = new THREE.BufferGeometry();
                particlesGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                const particlesMaterial = new THREE.PointsMaterial({
                    size: 0.015,
                    sizeAttenuation: true,
                    blending: THREE.AdditiveBlending,
                    transparent: true
                });
                particleSystem = new THREE.Points(particlesGeometry, particlesMaterial);
                scene.add(particleSystem);

                camera.position.z = 6;
            }

            const mouse = new THREE.Vector2();
            function handleUserInteraction(event) {
                // Use touch events for mobile, mouse events for desktop
                const x = event.touches ? event.touches[0].clientX : event.clientX;
                const y = event.touches ? event.touches[0].clientY : event.clientY;
                
                mouse.x = (x / window.innerWidth) * 2 - 1;
                mouse.y = -(y / window.innerHeight) * 2 + 1;
                
                resetIdleTimer();
            }

            // Add 3D-only event listeners for desktop
            if (!isMobileView) {
                window.addEventListener('mousemove', handleUserInteraction);
                window.addEventListener('mousedown', handleUserInteraction);
                window.addEventListener('touchmove', handleUserInteraction);
                window.addEventListener('touchstart', handleUserInteraction);
            }


            const clock = new THREE.Clock();
            /**
             * The main animation loop.
             */
            function animate() {
                // Stop the loop if on mobile and renderer isn't initialized
                if (isMobileView || !renderer) return;

                const elapsedTime = clock.getElapsedTime();

                // Rotate particles
                if (particleSystem) {
                    particleSystem.rotation.y = elapsedTime * 0.1;
                }

                // Apply mouse parallax
                if (imagePlane) {
                    const targetY = mouse.x * 0.1;
                    const targetX = -mouse.y * 0.1;
                    const smoothness = 0.05;
                    imagePlane.rotation.y += (targetY - imagePlane.rotation.y) * smoothness;
                    imagePlane.rotation.x += (targetX - imagePlane.rotation.x) * smoothness;
                    subtitlePlane.rotation.copy(imagePlane.rotation);
                }

                // Apply camera follow
                const cameraSmoothness = 0.02;
                camera.position.x += (mouse.x * 0.5 - camera.position.x) * cameraSmoothness;
                camera.position.y += (mouse.y * 0.5 - camera.position.y) * cameraSmoothness;
                camera.lookAt(scene.position);

                renderer.render(scene, camera);
                requestAnimationFrame(animate);
            }

            /**
             * Handles window resize (for 3D scene only).
             */
            if (!isMobileView) {
                window.addEventListener('resize', () => {
                    if (camera && renderer) { // Check if 3D elements exist
                        camera.aspect = window.innerWidth / window.innerHeight;
                        camera.updateProjectionMatrix();
                        renderer.setSize(window.innerWidth, window.innerHeight);
                        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                    }
                });
            }

            // --- Start Everything ---
            if (!isMobileView) {
                try {
                    init3D();
                    animate();
                } catch (e) {
                    console.error("Failed to initialize 3D scene:", e);
                    // Hide canvas if 3D fails to init
                    if(canvasEl) canvasEl.style.display = 'none';
                }
            }
            
            updateDisplay(0);
            resetIdleTimer();
        });
    </script>
</body>
</html>


